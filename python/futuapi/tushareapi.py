import tushare as ts
import pandas as pd
import pandas

# df = ts.get_realtime_quotes('600000') #Single stock symbol
# # df = ts.get_tick_data('600000',date='2019-10-14',src='tt')
# # print(df.tail(100))
# print(df[['code','name','price','bid','ask','volume','amount','time']])
# df = ts.get_today_ticks('600000',pause=0.1)
# print(df.head(30))
#
# df = ts.get_tick_data('600000',date='2019-10-14',src='tt')
# # print(df.tail(15))
# df['time'] = pd.to_datetime(df.time, format = '%H:%M:%S')
# df['type'] = '1'
# new_df = (df.groupby(['type', pd.Grouper(key='time', freq='1min')]).agg({'volume':'sum'}))
# # print(new_df)
# print(int(new_df['volume'].max()))
# dates =  pd.to_datetime(df.time, format='%H:%M:%S')
# print(dates)
# df = (df.assign(date=dates)
#         .groupby(['volume', pd.Grouper(key='date', freq='3D')])
#         .sum()
#         .reset_index())
# print(df)

# ts.set_token('daddc1dafa8c960707c5d9322901cddc1e42cebb978a8c58c86d30c3')
# pro = ts.pro_api()
# df = pro.daily(ts_code='600000.SH', start_date='20191015', end_date='20191015')
# print(df)
# #
a=[0,"0/09:25:05/13.08/-0.01/3260/4264080/S|1/09:30:00/13.06/-0.02/1267/1657765/S|2/09:30:03/13.07/0.01/1529/2002939/S|3/09:30:06/13.09/0.02/1171/1533037/B|4/09:30:09/13.10/0.01/73/95500/M|5/09:30:12/13.09/-0.01/113/148033/S|6/09:30:15/13.09/0.00/43/56287/B|7/09:30:18/13.10/0.01/24/31435/B|8/09:30:21/13.10/0.00/96/125760/B|9/09:30:24/13.11/0.01/308/403644/B|10/09:30:27/13.10/-0.01/411/538688/S|11/09:30:30/13.12/0.02/2/2624/B|12/09:30:33/13.12/0.00/60/79526/B|13/09:30:36/13.11/-0.01/156/204521/S|14/09:30:39/13.12/0.01/347/454082/B|15/09:30:42/13.11/-0.01/205/268911/M|16/09:30:45/13.12/0.01/550/722249/B|17/09:30:48/13.11/-0.01/151/197967/S|18/09:30:51/13.13/0.02/194/254382/B|19/09:30:54/13.13/0.00/178/233681/B|20/09:30:57/13.13/0.00/167/219318/S|21/09:31:00/13.13/0.00/115/150982/S|22/09:31:03/13.13/0.00/178/233703/B|23/09:31:06/13.12/-0.01/292/384205/S|24/09:31:09/13.12/0.00/105/137862/S|25/09:31:12/13.13/0.01/163/214112/M|26/09:31:15/13.14/0.01/226/296744/B|27/09:31:18/13.14/0.00/102/134028/B|28/09:31:21/13.13/-0.01/677/889344/S|29/09:31:24/13.15/0.02/259/339322/B|30/09:31:27/13.14/-0.01/178/233823/S|31/09:31:30/13.15/0.01/560/736287/B|32/09:31:33/13.15/0.00/202/265626/B|33/09:31:36/13.15/0.00/138/181458/B|34/09:31:39/13.15/0.00/145/190669/B|35/09:31:42/13.15/0.00/396/520717/B|36/09:31:45/13.15/0.00/808/1063188/B|37/09:31:48/13.16/0.01/230/302542/B|38/09:31:51/13.15/-0.01/279/366964/S|39/09:31:54/13.15/0.00/551/724838/S|40/09:31:57/13.15/0.00/126/164954/S|41/09:32:00/13.14/-0.01/486/638604/S|42/09:32:03/13.13/-0.01/180/236339/S|43/09:32:06/13.12/-0.01/241/316205/S|44/09:32:09/13.13/0.01/65/85297/B|45/09:32:12/13.12/-0.01/97/127838/S|46/09:32:15/13.12/0.00/127/166524/B|47/09:32:18/13.11/-0.01/44/57720/S|48/09:32:21/13.11/0.00/62/81251/S|49/09:32:24/13.11/0.00/44/57690/S|50/09:32:27/13.11/0.00/81/106141/B|51/09:32:30/13.11/0.00/46/60306/B|52/09:32:33/13.11/0.00/194/254308/B|53/09:32:36/13.10/-0.01/121/158556/S|54/09:32:39/13.10/0.00/833/1091729/S|55/09:32:42/13.11/0.01/190/248937/B|56/09:32:45/13.10/-0.01/773/1013217/S|57/09:32:48/13.11/0.01/47/61594/B|58/09:32:51/13.10/-0.01/141/184755/S|59/09:32:54/13.11/0.01/532/696948/M|60/09:32:57/13.11/0.00/220/288341/B|61/09:33:00/13.11/0.00/259/339556/B|62/09:33:03/13.12/0.01/193/253216/B|63/09:33:06/13.12/0.00/134/175869/S|64/09:33:09/13.13/0.01/70/91910/B|65/09:33:12/13.14/0.01/168/220645/B|66/09:33:15/13.13/-0.01/198/259929/S|67/09:33:18/13.13/0.00/854/1121302/B|68/09:33:21/13.12/-0.01/227/297991/S|69/09:33:24/13.11/-0.01/447/586188/S"]
date = a[-1].split('|')
new_data = [i.split('/')[0:-2] for i in date]
# new_data = [int(i[-1]) for i in new_data]
print(new_data)
# new_data.insert(0,['index','time','prise','zhangdie','volume'])
# print(new_data)

df = pd.DataFrame(new_data)
df.rename(columns={0: 'index', 1: 'time', 2: 'prise', 3: 'zhangdie', 4: 'volume'}, inplace=True)
df['time'] = pd.to_datetime(df.time, format='%H:%M:%S')
df['prise'] = 1
df['volume'] = df.volume.astype('int')

# print( df.dtypes)
new_df = (df.groupby(['prise', pd.Grouper(key='time', freq='1min')]).agg({'volume': 'sum'}))
print(new_df)